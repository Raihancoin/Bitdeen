<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>BDN Dashboard</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet" />
  <style>
    :root{--gold:#facc15;--bg:#061423}
    *{box-sizing:border-box;font-family:'Inter',sans-serif}
    body{margin:0;background:linear-gradient(180deg,#041628,#071a2a);color:#fff;min-height:100vh}
    header{display:flex;justify-content:space-between;align-items:center;padding:14px 18px;background:rgba(255,255,255,0.02);border-bottom:1px solid rgba(255,255,255,0.03)}
    .brand{display:flex;gap:12px;align-items:center}
    .logo-sm{width:44px;height:44px;background:url('https://i.ibb.co/gMDGSYkQ/Elegant-Bit-Deen-Cryptocurrency-Logo.png') center/cover;border-radius:10px;box-shadow:0 6px 18px rgba(250,204,21,0.08)}
    h1{margin:0;color:var(--gold);font-size:18px}
    main{padding:22px;max-width:980px;margin:0 auto}
    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:16px}
    .card{background:rgba(255,255,255,0.03);padding:16px;border-radius:12px;border:1px solid rgba(255,255,255,0.03)}
    .balance{font-size:14px;color:#bcd;display:flex;justify-content:space-between;align-items:center}
    .bigval{font-size:26px;font-weight:700;color:#fff;margin-top:6px}
    .claim-btn{width:100%;padding:12px;border-radius:10px;border:none;background:linear-gradient(90deg,var(--gold),#f59e0b);color:#111;font-weight:800;cursor:pointer;margin-top:12px}
    .stake-row{display:flex;gap:8px;margin-top:12px}
    input[type=number]{flex:1;padding:10px;border-radius:8px;border:none;background:rgba(255,255,255,0.04);color:#fff}
    .small{font-size:12px;color:#9fb0c3;margin-top:10px}
    footer{padding:18px;text-align:center;color:#9fb0c3;font-size:13px}
    .link{color:var(--gold);text-decoration:none;font-weight:700}
  </style>
</head>
<body>
  <header>
    <div class="brand">
      <div class="logo-sm" aria-hidden="true"></div>
      <div>
        <h1>BitDeen Dashboard</h1>
        <div style="font-size:12px;color:#9fb0c3">Secure Google Login</div>
      </div>
    </div>
    <div id="userBox" style="text-align:right">
      <div id="userName">â€”</div>
      <button id="logoutBtn" style="margin-top:6px;padding:8px 10px;border-radius:8px;border:none;background:transparent;color:var(--gold);cursor:pointer">Logout</button>
    </div>
  </header>

  <main>
    <div class="grid">
      <div class="card">
        <div class="balance">ðŸ’Ž Diamonds <span id="diamond">0</span></div>
        <div class="bigval" id="bdnVal">0 BDN</div>
        <div class="small">Stake to earn listing bonus. Listing bonus: <strong>$1000+ USDT</strong> (after official listing)</div>
      </div>

      <div class="card">
        <div style="font-weight:700;color:#bcd">Claim / Airdrop</div>
        <div class="small">Auto claim every hour. Boost level increases claim amount.</div>
        <button id="claimBtn" class="claim-btn">Loading...</button>
      </div>

      <div class="card">
        <div style="font-weight:700;color:#bcd">Stake BDN</div>
        <div class="small">Lock your BDN to qualify for listing payout</div>
        <div class="stake-row">
          <input id="stakeAmt" type="number" placeholder="Amount BDN" min="1" />
          <button id="stakeBtn" class="claim-btn" style="width:140px;padding:10px">Stake</button>
        </div>
        <div class="small">Your stakes are recorded and locked. Unlock only after listing or admin approval.</div>
      </div>

      <div class="card">
        <div style="font-weight:700;color:#bcd">Referral</div>
        <div class="small">Invite friends and get bonus boosts</div>
        <input id="refLink" readonly style="width:100%;padding:10px;border-radius:8px;border:none;background:rgba(255,255,255,0.03);color:#fff;margin-top:8px" />
        <div style="margin-top:8px"><button id="copyRef" style="padding:8px;border-radius:8px;background:rgba(255,255,255,0.04);border:none;color:var(--gold);cursor:pointer">Copy Invite Link</button></div>
      </div>
    </div>

    <div style="margin-top:18px" class="card">
      <div style="font-weight:700;color:#bcd">Activity / Transactions</div>
      <div id="activityList" class="small" style="margin-top:10px;max-height:180px;overflow:auto"></div>
    </div>
  </main>

  <footer>Â© <strong>BitDeen</strong> â€” Stake & Earn Â· Listing soon Â· Built secure with Firebase</footer>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-app.js";
    import { getAuth, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-auth.js";
    import { getDatabase, ref, get, child, set, update, onValue, push } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBxQ4EiH_aTCyJm5_VT0cRSDD97F_ObG1o",
      authDomain: "bitdeen-a1ebe.firebaseapp.com",
      databaseURL: "https://bitdeen-a1ebe-default-rtdb.firebaseio.com",
      projectId: "bitdeen-a1ebe",
      storageBucket: "bitdeen-a1ebe.appspot.com",
      messagingSenderId: "957332775205",
      appId: "1:957332775205:web:e34cc38d4d5282adc43acc",
      measurementId: "G-FY8TBYBJ58"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getDatabase(app);

    const userNameEl = document.getElementById('userName');
    const diamondEl = document.getElementById('diamond');
    const bdnValEl = document.getElementById('bdnVal');
    const claimBtn = document.getElementById('claimBtn');
    const stakeBtn = document.getElementById('stakeBtn');
    const stakeAmt = document.getElementById('stakeAmt');
    const refLinkInput = document.getElementById('refLink');
    const copyRefBtn = document.getElementById('copyRef');
    const logoutBtn = document.getElementById('logoutBtn');
    const activityList = document.getElementById('activityList');

    let currentUser = null;
    let userData = null;

    onAuthStateChanged(auth, async (user) => {
      if (!user) {
        window.location.href = 'login.html';
        return;
      }
      currentUser = user;
      userNameEl.innerText = user.displayName || user.email;
      // load user data from RTDB
      await loadUser();
      setupRefLink();
      listenActivity();
      setInterval(updateTimer, 1000);
    });

    logoutBtn.addEventListener('click', async () => {
      await signOut(auth);
      window.location.href = 'login.html';
    });

    async function loadUser() {
      const snap = await get(child(ref(db), `users/${currentUser.uid}`));
      if (snap.exists()) {
        userData = snap.val();
      } else {
        userData = { bdn:0, diamond:0, nextClaim:Date.now(), tokenBoostLevel:0 };
        await set(ref(db, `users/${currentUser.uid}`), userData);
      }
      refreshUI();
    }

    function refreshUI() {
      diamondEl.textContent = userData.diamond || 0;
      bdnValEl.textContent = (userData.bdn || 0) + ' BDN';
      updateTimer();
    }

    // Claim logic (hourly)
    function updateTimer(){
      if (!userData) return;
      const now = Date.now();
      if (now >= (userData.nextClaim || 0)) {
        claimBtn.disabled = false;
        claimBtn.textContent = `Claim +${1 + (userData.tokenBoostLevel||0)} BDN`;
      } else {
        claimBtn.disabled = true;
        const diff = (userData.nextClaim || 0) - now;
        const mins = Math.floor(diff/60000);
        const secs = Math.floor((diff%60000)/1000);
        claimBtn.textContent = `Wait ${String(mins).padStart(2,'0')}:${String(secs).padStart(2,'0')}`;
      }
    }

    claimBtn.addEventListener('click', async () => {
      const boost = userData.tokenBoostLevel || 0;
      const amount = 1 + boost;
      userData.bdn = (userData.bdn || 0) + amount;
      userData.nextClaim = Date.now() + 3600000; // +1h
      await update(ref(db, `users/${currentUser.uid}`), { bdn: userData.bdn, nextClaim: userData.nextClaim });
      refreshUI();
      // log activity
      await push(ref(db, `activity/${currentUser.uid}`), { type:'claim', amount, at:Date.now() });
    });

    // Stake
    stakeBtn.addEventListener('click', async () => {
      const amt = Number(stakeAmt.value || 0);
      if (!amt || amt <= 0) { alert('Enter valid stake amount'); return; }
      // reduce user's available bdn and create stake record
      // For demo: we allow staking without balance check (you can enforce any rule)
      const stakeObj = { amount: amt, at: Date.now(), unlockDate: null, status: 'locked' };
      await push(ref(db, `stakes/${currentUser.uid}`), stakeObj);
      // Optionally increment a "staked" field on user
      await push(ref(db, `activity/${currentUser.uid}`), { type:'stake', amount:amt, at:Date.now() });
      alert('Stake recorded. Admin will confirm unlock after listing.');
      stakeAmt.value = '';
      listenActivity(); // refresh
    });

    // Referral link
    function setupRefLink(){
      const origin = window.location.origin + window.location.pathname.replace(/[^\/]*$/, '');
      const link = `${window.location.origin}/login.html?ref=${currentUser.uid}`;
      refLinkInput.value = link;
    }
    copyRefBtn.addEventListener('click', async () => {
      await navigator.clipboard.writeText(refLinkInput.value);
      alert('Invite link copied');
    });

    // activity listener
    function listenActivity() {
      activityList.innerHTML = '';
      const actRef = ref(db, `activity/${currentUser.uid}`);
      onValue(actRef, (snapshot) => {
        activityList.innerHTML = '';
        snapshot.forEach(childSnap => {
          const a = childSnap.val();
          const t = new Date(a.at || Date.now()).toLocaleString();
          let txt = '';
          if (a.type === 'claim') txt = `Claimed ${a.amount} BDN â€” ${t}`;
          else if (a.type === 'stake') txt = `Staked ${a.amount} BDN â€” ${t}`;
          else txt = `${a.type} â€” ${t}`;
          const div = document.createElement('div');
          div.textContent = txt;
          div.style.padding = '8px 0';
          div.style.borderBottom = '1px dashed rgba(255,255,255,0.03)';
          activityList.appendChild(div);
        });
      });
    }
  </script>
</body>
        </html>
